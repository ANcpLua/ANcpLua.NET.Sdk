#!/bin/bash
# Architecture Lint Pre-commit Hook
# Prevents commits with Version.props/CPM violations

set -e

echo "üîç Running architecture lint..."

# Use the repo's bash script
SCRIPT_DIR="$(git rev-parse --show-toplevel)/scripts/lint-dotnet.sh"

if [ -f "$SCRIPT_DIR" ]; then
    bash "$SCRIPT_DIR" "$(git rev-parse --show-toplevel)"
    EXIT_CODE=$?
else
    echo "‚ö†Ô∏è  scripts/lint-dotnet.sh not found. Skipping."
    exit 0
fi

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "‚ùå Architecture violations found. Fix before committing."
    echo ""
    echo "Rules:"
    echo "  RULE_A: Use \$(VariableName) in Directory.Packages.props, not hardcoded versions"
    echo "  RULE_B: Only Directory.Packages.props or eng/Directory.Build.props may import Version.props"
    echo "  RULE_C: Version.props must be a symlink in consumer repos"
    echo "  RULE_G: Use CPM, not inline PackageReference versions"
    exit 1
fi

echo "‚úÖ Architecture lint passed"

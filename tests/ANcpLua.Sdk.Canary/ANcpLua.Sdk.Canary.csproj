<Project Sdk="ANcpLua.NET.Sdk.Test">
  <!--
    ANcpLua.Sdk.Canary - Local SDK Validation (<10 seconds)

    PURPOSE: Catch SDK packaging errors BEFORE waiting 30min for CI

    USAGE:
      ./canary.sh              # Quick validation
      dotnet test              # Run canary tests
      dotnet build -bl         # Generate binlog for debugging

    VALIDATES:
      SDK .props/.targets import correctly (no MSB4019/MSB4057)
      MTP detection works (OutputType=Exe)
      Polyfills compile on netstandard2.0
      Enforcement policies don't block legitimate usage
      Package injection works (xunit.v3.mtp-v2, AwesomeAssertions)
  -->

  <PropertyGroup>
    <TargetFrameworks>net10.0;netstandard2.0</TargetFrameworks>
    <IsPackable>false</IsPackable>

    <!-- net10.0 is the main test target -->
    <IsTestProject Condition="'$(TargetFramework)' == 'net10.0'">true</IsTestProject>

    <!-- netstandard2.0 is for polyfill validation only (no test runner) -->
    <IsTestProject Condition="'$(TargetFramework)' == 'netstandard2.0'">false</IsTestProject>
    <OutputType Condition="'$(TargetFramework)' == 'netstandard2.0'">Library</OutputType>

    <!-- Canary-specific: fail fast on any issue -->
    <TreatWarningsAsErrors>true</TreatWarningsAsErrors>
    <WarningsAsErrors />

    <!-- Diagnostics for debugging -->
    <ANcpLuaDiagnostics Condition="'$(ANcpLuaDiagnostics)' == ''">false</ANcpLuaDiagnostics>

    <!-- Enable polyfills for netstandard2.0 validation -->
    <InjectANcpLuaLanguageFeaturesPolyfills>true</InjectANcpLuaLanguageFeaturesPolyfills>
    <InjectANcpLuaNullabilityPolyfills>true</InjectANcpLuaNullabilityPolyfills>
    <InjectANcpLuaIndexRangePolyfills>true</InjectANcpLuaIndexRangePolyfills>
    <InjectANcpLuaDiagnosticsPolyfills>true</InjectANcpLuaDiagnosticsPolyfills>
  </PropertyGroup>

</Project>

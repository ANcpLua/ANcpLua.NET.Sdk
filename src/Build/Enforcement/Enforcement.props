<Project>
  <!-- Fail builds that violate SDK policy -->

  <!-- BANNED: PolySharp -->
  <Target Name="_EnforceNoPolySharp" BeforeTargets="ResolveReferences;Restore">
    <ItemGroup>
      <_PolySharpRefs Include="@(PackageReference)" Condition="'%(Identity)' == 'PolySharp'"/>
    </ItemGroup>
    <Error Condition="'@(_PolySharpRefs)' != ''"
           Text="POLICY: PolySharp is banned. Use ANcpLua.Roslyn.Utilities.Polyfills instead."/>
  </Target>

  <!-- NOTE: _EnforceNoPrivateAssetsAll removed in v1.3.12 - PrivateAssets='all' is legitimate
       for NETStandard.Library, analyzers, and other scenarios. The policy was too strict. -->

  <!-- BANNED: DisableTransitiveProjectReferences -->
  <Target Name="_EnforceNoDisableTransitive" BeforeTargets="BeforeBuild">
    <Error Condition="'$(DisableTransitiveProjectReferences)' == 'true'"
           Text="POLICY: DisableTransitiveProjectReferences banned. Use CentralPackageTransitivePinningEnabled."/>
  </Target>

  <!-- BANNED: Microsoft.NET.Test.Sdk ONLY when MTP is enabled -->
  <!-- For legacy xUnit v2 VSTest projects, Microsoft.NET.Test.Sdk is required -->
  <Target Name="_EnforceNoVSTestSdk" BeforeTargets="ResolveReferences;Restore"
          Condition="'$(UseMicrosoftTestingPlatform)' == 'true'">
    <ItemGroup>
      <_VSTestSdk Include="@(PackageReference)" Condition="'%(Identity)' == 'Microsoft.NET.Test.Sdk'"/>
    </ItemGroup>
    <Error Condition="'@(_VSTestSdk)' != ''"
           Text="POLICY: Microsoft.NET.Test.Sdk banned when UseMicrosoftTestingPlatform=true. MTP projects don't need VSTest infrastructure."/>
  </Target>

  <!-- BANNED: FluentAssertions -->
  <Target Name="_EnforceNoFluentAssertions" BeforeTargets="ResolveReferences;Restore">
    <ItemGroup>
      <_FluentAssertions Include="@(PackageReference)" Condition="'%(Identity)' == 'FluentAssertions'"/>
    </ItemGroup>
    <Error Condition="'@(_FluentAssertions)' != ''"
           Text="POLICY: FluentAssertions banned. Use AwesomeAssertions."/>
  </Target>

  <!-- ENFORCE: Central Package Management -->
  <!-- Set ANcpLuaSdkSkipCPMEnforcement=true to opt-out (for SDK tests) -->
  <Target Name="_EnforceCPM" BeforeTargets="BeforeBuild"
          Condition="'$(ANcpLuaSdkSkipCPMEnforcement)' != 'true'">
    <Error Condition="'$(ManagePackageVersionsCentrally)' != 'true'"
           Text="POLICY: ManagePackageVersionsCentrally=true required in Directory.Packages.props"/>
    <Error Condition="'$(CentralPackageTransitivePinningEnabled)' != 'true'"
           Text="POLICY: CentralPackageTransitivePinningEnabled=true required in Directory.Packages.props"/>
  </Target>

  <!-- ENFORCE: .NET 10+ SDK -->
  <Target Name="_EnforceNet10Sdk" BeforeTargets="BeforeBuild">
    <Error Condition="$([MSBuild]::VersionLessThan('$(NETCoreSdkVersion)', '10.0.0'))"
           Text="POLICY: .NET SDK 10.0.0+ required. Current: $(NETCoreSdkVersion)"/>
  </Target>

  <!-- SINGLE TARGET: Run all enforcement -->
  <Target Name="CheckEnforcement"
          DependsOnTargets="_EnforceNoPolySharp;_EnforceNoDisableTransitive;_EnforceNoVSTestSdk;_EnforceNoFluentAssertions;_EnforceCPM;_EnforceNet10Sdk"/>

</Project>
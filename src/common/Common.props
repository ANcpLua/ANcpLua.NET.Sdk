<Project>
  <Import Project="$(MSBuildThisFileDirectory)/ContinuousIntegrationBuild.props"/>
  <Import Project="$(MSBuildThisFileDirectory)/LegacySupport.props"/>

  <PropertyGroup Label="Git Detection">
    <_ANcpLuaGitDir Condition="'$(_ANcpLuaGitDir)' == ''">$([MSBuild]::GetDirectoryNameOfFileAbove('$(MSBuildProjectDirectory)', '.git'))</_ANcpLuaGitDir>
    <_ANcpLuaInGitRepo Condition="'$(_ANcpLuaGitDir)' != ''">true</_ANcpLuaInGitRepo>
    <_ANcpLuaInGitRepo Condition="'$(_ANcpLuaInGitRepo)' == ''">false</_ANcpLuaInGitRepo>
  </PropertyGroup>

  <PropertyGroup Condition="'$(_ANcpLuaInGitRepo)' != 'true'">
    <EnableSourceLink>false</EnableSourceLink>
    <EnableSourceControlManagerQueries>false</EnableSourceControlManagerQueries>
    <!-- Don't set PublishRepositoryUrl to false - let default (true) apply -->
  </PropertyGroup>

  <PropertyGroup>
    <SuppressNETCoreSdkPreviewMessage>true</SuppressNETCoreSdkPreviewMessage>
    <_IsANcpLuaProject>$(MSBuildProjectName.StartsWith('ANcpLua', StringComparison.OrdinalIgnoreCase))</_IsANcpLuaProject>

    <!-- SDK Defaults - inject essential shared code -->
    <InjectSharedThrow Condition="'$(InjectSharedThrow)' == ''">true</InjectSharedThrow>
    <GenerateClaudeMd Condition="'$(GenerateClaudeMd)' == ''">true</GenerateClaudeMd>
  </PropertyGroup>

  <PropertyGroup>
    <!-- Publish the repository URL in the built .nupkg (in the NuSpec <Repository> element) -->
    <PublishRepositoryUrl Condition="'$(PublishRepositoryUrl)' == ''">true</PublishRepositoryUrl>

    <!-- Embed symbols containing Source Link in the main file (exe/dll) -->
    <DebugType>embedded</DebugType>
    <!-- Embed source files that are not tracked by the source control manager in the PDB -->
    <EmbedUntrackedSources Condition="'$(EmbedUntrackedSources)' == ''">true</EmbedUntrackedSources>
    <IncludeSourceRevisionInInformationalVersion Condition="'$(IncludeSourceRevisionInInformationalVersion)' == ''">true</IncludeSourceRevisionInInformationalVersion>
    <EnableSourceControlManagerQueries Condition="'$(EnableSourceControlManagerQueries)' == ''">true</EnableSourceControlManagerQueries>
    <EnableSourceLink Condition="'$(EnableSourceLink)' == ''">true</EnableSourceLink>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>

    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <!-- CS1573: Parameter has no XML doc comment - SDK internals don't require full docs
         CS1591: Missing XML comment - generated/internal code doesn't need docs -->
    <NoWarn>$(NoWarn);CS1573;CS1591</NoWarn>

    <!--
        Disabling static graph restore due to a bug related to NuGetAuditSuppress.
        See: https://github.com/NuGet/Home/issues/14300
      -->
    <RestoreUseStaticGraphEvaluation>false</RestoreUseStaticGraphEvaluation>
    <RestoreSerializeGlobalProperties>true</RestoreSerializeGlobalProperties>

    <ReportAnalyzer>true</ReportAnalyzer>
    <Features>strict</Features>
    <Deterministic>true</Deterministic>
    <EnableNETAnalyzers>true</EnableNETAnalyzers>
    <AnalysisLevel>latest-all</AnalysisLevel>
    <AllowUnsafeBlocks>true</AllowUnsafeBlocks>
    <LangVersion Condition="'$(LangVersion)' == ''">latest</LangVersion>
    <!-- CA1014: Mark assemblies with CLSCompliant - not relevant for modern .NET 10+ projects -->
    <NoWarn>$(NoWarn);CA1014</NoWarn>
    <MSBuildTreatWarningsAsErrors Condition="'$(ContinuousIntegrationBuild)' == 'true' OR '$(Configuration)' == 'Release'">true</MSBuildTreatWarningsAsErrors>
    <TreatWarningsAsErrors Condition="'$(ContinuousIntegrationBuild)' == 'true' OR '$(Configuration)' == 'Release'">true</TreatWarningsAsErrors>
    <EnforceCodeStyleInBuild Condition="'$(ContinuousIntegrationBuild)' == 'true' OR '$(Configuration)' == 'Release'">true</EnforceCodeStyleInBuild>

    <EnablePackageValidation Condition="'$(EnablePackageValidation)' == ''">true</EnablePackageValidation>
    <ManagePackageVersionsCentrally Condition="'$(ManagePackageVersionsCentrally)' == ''">true</ManagePackageVersionsCentrally>
    <CentralPackageTransitivePinningEnabled Condition="'$(CentralPackageTransitivePinningEnabled)' == ''">true</CentralPackageTransitivePinningEnabled>
  </PropertyGroup>

  <ItemDefinitionGroup>
    <PackageReference>
      <PrivateAssets></PrivateAssets>
    </PackageReference>
  </ItemDefinitionGroup>

  <PropertyGroup Label="NuGet Audit">
    <NuGetAudit>true</NuGetAudit>
    <NuGetAuditMode>all</NuGetAuditMode>
    <NuGetAuditLevel>low</NuGetAuditLevel>
    <WarningsAsErrors Condition="'$(ContinuousIntegrationBuild)' == 'true' OR '$(Configuration)' == 'Release'">$(WarningsAsErrors);NU1900;NU1901;NU1902;NU1903;NU1904</WarningsAsErrors>
  </PropertyGroup>

  <PropertyGroup>
    <AccelerateBuildsInVisualStudio>true</AccelerateBuildsInVisualStudio>
  </PropertyGroup>

  <!-- NOTE: Microsoft.SourceLink.GitHub is NOT injected here.
       .NET 8+ includes SourceLink by default. Since this SDK requires .NET 10+,
       SourceLink is always available without a package reference. -->

  <ItemGroup>
    <!-- Shared injected test bases are packaged, not compiled -->
    <Compile Remove="$(MSBuildThisFileDirectory)..\Shared\*.cs"/>
    <None Include="$(MSBuildThisFileDirectory)..\Shared\*.cs" Pack="false"/>

    <!-- Add all editorconfig files -->
    <EditorConfigFiles Include="$(MSBuildThisFileDirectory)../configuration/*.editorconfig"/>
  </ItemGroup>

</Project>
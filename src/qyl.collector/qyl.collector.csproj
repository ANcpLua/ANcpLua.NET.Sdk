<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>net10.0</TargetFramework>
    <OutputType>Exe</OutputType>
    <PublishAot>true</PublishAot>
    <InvariantGlobalization>true</InvariantGlobalization>
  </PropertyGroup>

  <!-- =========================================================================
       CLAUDE.md Configuration - AI Context Metadata
       ========================================================================= -->
  <PropertyGroup>
    <ClaudePurpose>Telemetry collector with OTLP ingestion, DuckDB storage, SSE streaming</ClaudePurpose>
    <ClaudeLayer>backend</ClaudeLayer>
    <ClaudeWorkflow>explore-plan-code-commit</ClaudeWorkflow>
    <ClaudeTestCoverage>80</ClaudeTestCoverage>
  </PropertyGroup>

  <!-- Import parent context files (inheritance chain) -->
  <ItemGroup>
    <ClaudeImport Include="$(RepoRoot)/spec/MASTER.md" />
    <ClaudeImport Include="$(RepoRoot)/spec/UML.md" />
    <ClaudeImport Include="$(RepoRoot)/spec/collector-duckdb.md" />
    <ClaudeImport Include="$(RepoRoot)/spec/collector-rest-api.md" />
  </ItemGroup>

  <!-- Critical files that need extra attention -->
  <ItemGroup>
    <ClaudeCriticalFile Include="Storage/DuckDbStore.cs" Reason="Core persistence - schema changes break data" />
    <ClaudeCriticalFile Include="Storage/DuckDbSchema.cs" Reason="DDL definitions - must match DuckDbStore" />
    <ClaudeCriticalFile Include="Ingestion/GenAiExtractor.cs" Reason="OTel 1.38 compliance - attribute mapping" />
    <ClaudeCriticalFile Include="Realtime/SseHub.cs" Reason="Live streaming - affects all dashboard clients" />
    <ClaudeCriticalFile Include="Program.cs" Reason="DI registration - service configuration" />
  </ItemGroup>

  <!-- Anti-patterns to reject -->
  <ItemGroup>
    <ClaudeAntiPattern Include="DateTime.Now" UseInstead="TimeProvider.System.GetLocalNow()" Severity="error" />
    <ClaudeAntiPattern Include="DateTime.UtcNow" UseInstead="TimeProvider.System.GetUtcNow()" Severity="error" />
    <ClaudeAntiPattern Include="private readonly object _lock" UseInstead="private readonly Lock _lock" Severity="error" />
    <ClaudeAntiPattern Include="SemaphoreSlim for sync" UseInstead="Lock class" Severity="error" />
    <ClaudeAntiPattern Include=".GroupBy().ToDictionary()" UseInstead=".CountBy() or .AggregateBy()" Severity="warning" />
    <ClaudeAntiPattern Include="Task.WhenAny loops" UseInstead="Task.WhenEach()" Severity="warning" />
    <ClaudeAntiPattern Include="new Dictionary&lt;&gt; when order matters" UseInstead="new OrderedDictionary&lt;&gt;" Severity="warning" />
    <ClaudeAntiPattern Include="gen_ai.system" UseInstead="gen_ai.provider.name" Severity="error" />
    <ClaudeAntiPattern Include="gen_ai.usage.prompt_tokens" UseInstead="gen_ai.usage.input_tokens" Severity="error" />
  </ItemGroup>

  <!-- Required patterns to enforce -->
  <ItemGroup>
    <ClaudeRequiredPattern Include="Lock" Description=".NET 9+ Lock class for thread-safe sync" Example="private readonly Lock _lock = new();" />
    <ClaudeRequiredPattern Include="FrozenSet&lt;string&gt;" Description="Immutable lookup sets for static data" Example="FrozenSet.ToFrozenSet(StringComparer.Ordinal)" />
    <ClaudeRequiredPattern Include="FrozenDictionary&lt;K,V&gt;" Description="Immutable dictionaries for config" />
    <ClaudeRequiredPattern Include="SearchValues&lt;T&gt;" Description="SIMD-optimized membership tests" />
    <ClaudeRequiredPattern Include="TypedResults.ServerSentEvents()" Description="SSE streaming in .NET 10" />
    <ClaudeRequiredPattern Include="JsonNamingPolicy.SnakeCaseLower" Description="API serialization policy" />
    <ClaudeRequiredPattern Include="HybridCache" Description="Stampede-proof caching" />
  </ItemGroup>

  <!-- =========================================================================
       Package References
       ========================================================================= -->
  <ItemGroup>
    <PackageReference Include="Google.Protobuf" Version="3.29.3" />
    <PackageReference Include="Grpc.AspNetCore" Version="2.67.0" />
    <PackageReference Include="OpenTelemetry.Api" Version="1.11.0" />
    <PackageReference Include="DuckDB.NET.Data" Version="1.2.0" />
    <PackageReference Include="System.IO.Hashing" Version="9.0.0" />
  </ItemGroup>

</Project>
